//Gets all players on a team 

select pr.first, pr.last
from team tm
join player pl
	on tm.id = pl.team
join person pr
	on pl.person = pr.id
where tm.id = 1


//Insert person and player
INSERT INTO `dmahockey`.`person` (`first`, `last`) VALUES ('John', 'Doe');
INSERT INTO `dmahockey`.`player` (`person`, `team`) VALUES ('2', '1'); 	//person, team

//Get Roster
select t.name, pl.id, pr.first, pr.last
from team t
join player pl
	on t.id = pl.team
join person pr
	on pl.person = pr.id
where t.id = 1
order by pr.last, pr.first

//Get Penalties
SELECT * 
FROM  `all_types` 
WHERE category =  'penalty_detail'
ORDER BY typeName

//Penalties query
SELECT pr.first, pr.last, t.name, sum(p.duration) as pm, (sum(p.duration)/gp.games) as 'pen_ratio'
FROM team t
JOIN player pl
	ON t.id = pl.team
JOIN person pr
	ON pl.person = pr.id
JOIN event e
	ON pl.id = e.player
JOIN penalty p
	ON e.id = p.id
JOIN (SELECT t.id, count(t.id) as 'games'
        FROM team t
        JOIN schedule s
            ON t.id = s.home or t.id = s.away
        JOIN game g
            ON s.id = g.id
		GROUP BY t.id) gp
ON t.id = gp.id
WHERE t.season = 9
	AND e.type = 3
GROUP BY pr.first, pr.last, t.name
ORDER BY pm DESC



// **** under construction Points Query

#BASIC:
SELECT player,
	count(case when type = 1 then 1 end) G,
	count(case when type = 2 then 1 end) A,
	count(case when type in (1,2) then 1 end) Pts
FROM event
GROUP BY player
ORDER BY Pts DESC, G DESC, player

#FULL
SELECT p.first, p.last, t.abbreviation,
	count(case when e.type = 1 then 1 end) G,
	count(case when e.type = 2 then 1 end) A,
	count(case when e.type in (1,2) then 1 end) Pts
FROM event e
JOIN person p
	ON e.player = p.id
JOIN player pl
	ON e.player = pl.id
JOIN team t
	ON pl.team = t.id
WHERE t.season = 9
GROUP BY p.first, p.last, t.abbreviation
ORDER BY Pts DESC, G DESC, p.last, p.first
LIMIT 10


### GOALIE QUERY ###
SELECT pr.first, 
	pr.last, 
	tm.abbreviation,
	ROUND(sum(g.duration)/57, 1) as games,
	sum(g.goals_against) as goals, 
	ROUND(sum(g.goals_against)/(sum(g.duration)/57), 2) AS gaa,
	COUNT(case when g.goals_against = 0 then 1 end) as so
FROM goalie g
JOIN player pl
	on g.player = pl.id
JOIN person pr
	on pl.person = pr.id
JOIN team tm
	on pl.team = tm.id
WHERE tm.season = 9
GROUP BY pr.first, pr.last
HAVING games >= 3
ORDER BY gaa, games DESC, pr.last